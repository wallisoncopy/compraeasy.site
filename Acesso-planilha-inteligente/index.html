<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Planilha Inteligente de Produtos - Supermercado</title>
  <link rel="stylesheet" href="styles.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Roboto+Mono:wght@400;500&display=swap" rel="stylesheet">
</head>
<body>
  <!-- Tela de Login -->
  <div id="loginScreen" class="login-container">
    <div class="login-card">
      <div class="login-header">
        <div class="login-icon">🏪</div>
        <h1>Planilha Inteligente</h1>
        <p>Sistema de Gestão de Produtos</p>
      </div>
      <form id="loginForm" class="login-form">
        <div class="form-group">
          <label for="supermarketName">Nome do Supermercado Mercearia ou Padaria</label>
          <input type="text" id="supermarketName" placeholder="Ex: Supermercado São José" required>
        </div>
        <div class="form-group">
          <label for="password">Senha</label>
          <input type="password" id="password" placeholder="Digite qualquer senha">
        </div>
        <div class="form-group">
          <label for="colorTheme">Cor do Sistema</label>
          <select id="colorTheme" class="color-select">
            <option value="theme-pao-de-acucar">🔴 Vermelho</option>
            <option value="theme-extra">🔵 Azul</option>
            <option value="theme-carrefour">🟠 Laranja</option>
            <option value="theme-big">🟣 Roxo</option>
            <option value="theme-atacadao">🟢 Verde</option>
            <option value="theme-default">⚫ Padrão</option>
          </select>
        </div>
        <button type="submit" class="login-btn" id="loginBtn">
          <span class="btn-text">🛒 Acessar Sistema</span>
          <div class="loading-spinner" style="display: none;"></div>
        </button>
      </form>
      <div class="login-tip">
        💡 Dica: Use qualquer senha para acessar o sistema
      </div>
    </div>
  </div>

  <!-- Sistema Principal -->
  <div id="mainSystem" class="main-container" style="display: none;">
    <!-- Header -->
    <header class="main-header">
      <div class="header-content">
        <div class="header-left">
          <div class="header-icon">📈</div>
          <div class="header-info">
            <h1 id="systemTitle">Planilha Inteligente de Produtos</h1>
            <p>Período padrão: <strong>Mensal (30 dias)</strong></p>
            <small>Ajuste consumo médio e lead time para cálculo do ponto de reposição.</small>
          </div>
        </div>
        <button class="logout-btn" id="logoutBtn">🚪 Sair</button>
      </div>
    </header>

    <div class="wrap">
      <!-- Busca e Filtros -->
      <div class="search-filters">
        <div class="search-box">
          <input type="text" id="searchProducts" placeholder="🔍 Buscar produto..." data-testid="input-search">
        </div>
        <div class="filter-box">
          <select id="filterCategory" data-testid="select-category">
            <option value="">📂 Todas as categorias</option>
            <option value="Mercearia">🌾 Mercearia</option>
            <option value="Açougue">🥩 Açougue</option>
            <option value="Padaria">🍞 Padaria</option>
            <option value="Frios">🧀 Frios</option>
            <option value="Limpeza">🧽 Limpeza</option>
            <option value="Higiene">🧼 Higiene</option>
            <option value="Hortifrúti">🥬 Hortifrúti</option>
            <option value="Bebidas">🥤 Bebidas</option>
          </select>
        </div>
        <div class="sort-box">
          <select id="sortProducts" data-testid="select-sort">
            <option value="">📋 Ordenar por...</option>
            <option value="name">📝 Nome A-Z</option>
            <option value="category">📂 Categoria</option>
            <option value="profit">💰 Maior Lucro</option>
            <option value="stock">📦 Menor Estoque</option>
            <option value="consumption">📈 Mais Vendido</option>
          </select>
        </div>
        <button class="btn filter-btn" onclick="limparFiltros()" data-testid="button-clear-filters">🗑️ Limpar</button>
      </div>

      <!-- Controles -->
      <div class="controls">
        <button class="btn" onclick="adicionarLinha()">➕ Produto</button>
        <button class="btn warning" onclick="gerarListaCompras()">🛒 Lista de Compras</button>
        <button class="btn" onclick="salvarDados()">💾 Salvar Lista</button>
        <button class="btn" onclick="carregarDados()">📂 Carregar Lista</button>
        <button class="btn" onclick="exportarCSV()">⬇ Exportar CSV</button>
        <button class="btn secondary" onclick="calcular()">📊 Recalcular</button>
        <button class="btn danger" onclick="resetarTudo()">🔄 Reset Completo</button>
      </div>

      <!-- Tabela de Produtos -->
      <div class="table-container">
        <table id="tabela">
          <thead>
            <tr>
              <th>Produto</th>
              <th>Categoria</th>
              <th>Consumo Médio / Mês</th>
              <th>Estoque Atual</th>
              <th>Preço Compra (R$)</th>
              <th>Preço Venda (R$)</th>
              <th>Lead Time (dias)</th>
              <th>Qtd. Sugerida</th>
              <th>Ponto Reposição</th>
              <th>Lucro Pot. / Mês (R$)</th>
              <th>Ação</th>
            </tr>
          </thead>
          <tbody>
            <!-- Produtos pré-preenchidos serão inseridos aqui pelo JavaScript -->
          </tbody>
        </table>
      </div>

      <!-- Resumo -->
      <div class="summary">
        <div class="card">
          <div class="card-title">⚠️ Produtos em risco de falta</div>
          <div id="riscoList" class="risk-content">Nenhum</div>
        </div>
        <div class="card">
          <div class="card-title">💰 Total Estimado de Compra (R$)</div>
          <div id="totalCompra" class="total-value">R$ 0,00</div>
        </div>
        <div class="card">
          <div class="card-title">📈 Lucro Potencial Mensal (R$)</div>
          <div id="totalLucro" class="profit-value">R$ 0,00</div>
        </div>
      </div>

      <!-- Gráfico -->
      <div class="chart-container">
        <canvas id="chartConsumo" height="120"></canvas>
      </div>

      <!-- Rodapé -->
      <footer class="main-footer">
        💡 <strong>Dica:</strong> preencha o <strong>Consumo Médio / Mês</strong> com média de vendas reais.<br>
        Lead Time = dias que o fornecedor demora para entregar (use 7 se não souber).
      </footer>
    </div>
  </div>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  
  <!-- Base de dados de produtos -->
  <script src="data/products.js"></script>
  
  <script src="script.js"></script>
</body>
</html>